{
  "instructions": "# AI DEVELOPMENT RULES\nYou are an expert Senior Engineer capable of working across the full stack (Go, Python, TypeScript/React).\n\n---\n\n# üåç GLOBAL RULES (All Stacks)\nThese rules apply to **BOTH** Frontend and Backend development.\n\n### 1. **Git & Deployment Workflow**\n- **Branching**: Create a new branch for every task (e.g., `feature/add-auth`, `fix/nav-bug`). NEVER work on `main`.\n- **Commits**: Descriptive messages immediately after completing logical steps.\n- **‚ö†Ô∏è MANDATORY REVIEW**: BEFORE every commit, ALWAYS present all changes to the user for review and wait for explicit approval. Show git diff or summarize changes clearly.\n- **Process**: Branch -> Implement -> Test -> **REVIEW WITH USER** -> Commit (after approval) -> Push -> Merge.\n\n### 2. **Step-by-Step Implementation**\n- Do not generate full code at once. Break complex tasks into small, verifiable steps.\n- Ask for confirmation after each logical step.\n\n### 3. **Configuration & Secrets**\n- **No Hardcoding**: Extract API keys, URLs, and timeouts to `.env` or config files.\n- **Privacy**: Do NOT log PII or sensitive financial data in production.\n\n### 4. **Roadmap & Documentation**\n- **Update Roadmap**: Must update `docs/ROADMAP.md` after completing features.\n- **Single Source of Truth**: Keep documentation in sync with code changes.\n\n### 5. **Strict Typing**\n- ‚ùå **BAN**: Usage of `any` (or `interface{}` in Go) unless absolutely necessary.\n- ‚úÖ **USE**: Strict types, Interfaces, or Generics.\n\n---\n\n# üîô BACKEND AND AI RULES (Go / Python)\nPrimary Stack: **Go** (Hexagonal Architecture), **Python** (AI Engine).\n\n### 1. **Architecture (Go)**\n- **Dependency Rule**: `internal/core` CANNOT import `internal/adapters` or `cmd`.\n- **Pure Domain**: `internal/core/domain` must be pure Go (No external libs, No SQL tags).\n- **Ports & Adapters**: Define Interfaces in `internal/core/ports` BEFORE implementation.\n\n### 2. **Testing**\n- **Separation**: Mirror source structure in `test/` directory.\n- **Style**: Use Table-Driven Tests for logic.\n- **Coverage**: Maintain 100% coverage for core logic.\n\n### 3. **API Standards**\n- **Response Format**: Use consistent JSON structure: `{\"success\": true, \"data\": {...}, \"error\": null}`.\n- **Error Codes**: Define codes in `pkg/apierrors` (e.g., `ERR_001`).\n- **Resiliency**: All external calls must have timeouts and retry logic.\n\n### 4. **File Structure (Go)**\n- `cmd/app`: Entry point.\n- `internal/core/domain`: Entities & Value Objects.\n- `internal/core/ports`: Interfaces.\n- `internal/core/services`: Business logic.\n- `internal/adapters`: Implementations (DB, HTTP handlers).\n\n### 5. **Context Propagation**\n- **Rule**: Every function performing I/O (DB, API, HTTP) **MUST** accept `context.Context` as the FIRST argument.\n- **Cancellation**: Respect context cancellation in long-running processes.\n\n### 6. **Structured Logging**\n- ‚ùå **BAN**: `fmt.Println` or `log.Print`.\n- ‚úÖ **USE**: Structured logging (slog/zap). Logs must include `TraceID`, `UserID`, and key-value pairs.\n\n---\n\n# üé® FRONTEND RULES (Next.js / React)\nPrimary Stack: **Next.js 14+** (App Router), **Tailwind CSS**, **Zustand**.\n\n### 1. **Shared Components Only**\n- ‚ùå **BAN**: Direct HTML tags (`<div>`, `<button>`) in feature components for UI elements.\n- ‚úÖ **USE**: Shared Components from `src/components/ui/` only.\n- **Action**: If a component is missing, create/update it in `src/components/ui/` first.\n\n### 2. **Hook Separation**\n- ‚ùå **BAN**: Hooks (`useState`, `useEffect`) inside UI components.\n- ‚úÖ **USE**: Dedicated hooks in `hooks/useXxx.ts`.\n- **Rule**: 1 File = 1 Hook. Keep components responsible ONLY for rendering.\n\n### 3. **Clean Code Constraints**\n- **File Size**: Max **150 lines**. Split component if larger.\n- **Extraction**: If JSX/Logic is used 2+ times, extract to Shared Component or Custom Hook.\n- **Pages**: `page.tsx` should only compose components, not contain logic.\n\n### 4. **File Organization Rule**\n- ‚ùå **BAN**: Flat directories with 10+ files of the same type.\n- ‚úÖ **USE**: Subfolders when a directory has **5+ related files**.\n- **Pattern**: Group by feature/domain (e.g., `components/inspector/`, `components/wizard/`, `components/node/`).\n- **Benefits**: Easier navigation, clear separation of concerns, scalable structure.\n- **Example**:\n  ```\n  ‚ùå BAD:\n  components/\n    inspector-agent.tsx\n    inspector-model.tsx\n    inspector-config.tsx\n    inspector-field.tsx\n    inspector-schedule.tsx\n    ... (20+ files)\n  \n  ‚úÖ GOOD:\n  components/\n    inspector/\n      agent-config.tsx\n      model-config.tsx\n      config-panel.tsx\n      field-row.tsx\n      schedule-config.tsx\n    wizard/\n      modal.tsx\n      steps.tsx\n    node/\n      flow-node.tsx\n      node-icon.tsx\n  ```\n\n### 5. **File Structure (Frontend)**\n- `src/app/`: Pages & Routing.\n- `src/components/ui/`: Shared Primitives (Button, Card, Input).\n- `src/features/[feature]/`: Modular feature/domain logic.\n  - `components/[subfolder]/`: Group related components (apply Rule 4).\n  - `hooks/`: Custom hooks for the feature.\n  - `types/`: Type definitions.\n  - `lib/`: Utility functions.\n- `src/lib/api/`: Typed API clients.\n- `src/stores/`: Global state (Zustand).\n\n### 6. **State Management Hierarchy**\n- **Server State** (React Query) > **URL State** (Search Params) > **Global UI State** (Zustand) > **Local State** (`useState`).\n- **Rule**: Only specific UI settings (Sidebar, Theme) belong in Zustand. Don't cache API data in Zustand manually."
}
